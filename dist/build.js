this.b3editor=this.b3editor||{},function(){"use strict";var a={zoom_initial:1,zoom_min:.25,zoom_max:2,zoom_step:.25,snap_x:16,snap_y:16,snap_offset_x:0,snap_offset_y:0,connection_width:2,anchor_border_width:2,anchor_radius:7,anchor_offset_x:4,anchor_offset_y:0,block_border_width:2,block_root_width:40,block_root_height:40,block_composite_width:40,block_composite_height:40,block_decorator_width:60,block_decorator_height:60,block_action_width:160,block_action_height:40,block_condition_width:160,block_condition_height:40};b3editor.OPTIONS=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a={key_remove:"delete",key_select_all:"ctrl+a",key_deselect_all:"ctrl+shift+a",key_invert_selection:"ctrl+i",key_copy:"ctrl+c",key_cut:"ctrl+x",key_paste:"ctrl+v",key_organize:"a",key_zoom_in:"ctrl+up",key_zoom_out:"ctrl+down",key_new_tree:"",key_import_tree:"",key_export_tree:""};b3editor.SHORTCUTS=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a={background_color:"#171717",selection_color:"#4bb2fd",block_background_color:"#EFEFEF",block_border_color:"#6d6d6d",block_symbol_color:"#333",anchor_background_color:"#EFEFEF",anchor_border_color:"#6d6d6d",connection_color:"#6d6d6d"};b3editor.THEME_DARK=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this._dict={}},b.clear=function(){this._dict={}},b.set=function(a,b){this._dict[a]=b},b.get=function(a){return this._dict[a]},b.load=function(a){for(var b in a)this.set(b,a[b])},b3editor.SettingsManager=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.name="Root",b.category="root",b.title="A Behavior Tree",b3editor.Root=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.depth=0,this.leafCont=0,this.horizontalSpacing=208,this.verticalSpacing=64,this.orderByIndex=!1,this.connections=[],this.blocks=[]},b.__step=function(a){if(this.blocks.push(a),0==a.outConnections.length){this.leafCont++;var b=this.depth*this.horizontalSpacing,c=this.leafCont*this.verticalSpacing}else{var d=0;if(this.orderByIndex)var e=a.outConnections;else var e=a.getOutConnectionsByOrder();for(var f=0;f<e.length;f++)this.depth++,this.connections.push(e[f]),d+=this.__step(e[f].outBlock),this.depth--;var b=this.depth*this.horizontalSpacing,c=d/a.outConnections.length}return a.displayObject.x=b,a.displayObject.y=c,c},b.organize=function(a,b){if(a){this.depth=0,this.leafCont=0,this.connections=[],this.blocks=[],this.orderByIndex=b;var c=a.displayObject.x,d=a.displayObject.y,a=a;this.__step(a),c-=a.displayObject.x,d-=a.displayObject.y;for(var e=0;e<this.blocks.length;e++)this.blocks[e].displayObject.x+=c,this.blocks[e].displayObject.y+=d;for(var e=0;e<this.connections.length;e++)this.connections[e].redraw()}},b3editor.Organizer=a}(),this.b3editor=this.b3editor||{},this.b3editor.draw=this.b3editor.draw||{},function(){"use strict";var a=function(a,b,c,d,e,f,g){a.graphics.beginFill(e),a.graphics.setStrokeStyle(f,"round"),a.graphics.beginStroke(g),a.graphics.drawCircle(b,c,d),a.graphics.endStroke(),a.graphics.endFill()},b=function(a,b,c,d,e,f,g){a.graphics.beginFill(e),a.graphics.setStrokeStyle(f,"round"),a.graphics.beginStroke(g),a.graphics.drawRoundRect(-b/2,-c/2,b,c,d),a.graphics.endStroke(),a.graphics.endFill()},c=function(a,b,c,d,e,f){a.graphics.beginFill(d),a.graphics.setStrokeStyle(e,"round"),a.graphics.beginStroke(f),a.graphics.drawEllipse(-b/2,-c/2,b,c),a.graphics.endStroke(),a.graphics.endFill()},d=function(a,b,c,d,e,f){a.graphics.beginFill(d),a.graphics.setStrokeStyle(e,"round"),a.graphics.beginStroke(f),a.graphics.moveTo(0,c/2),a.graphics.lineTo(b/2,0),a.graphics.lineTo(0,-c/2),a.graphics.lineTo(-b/2,0),a.graphics.lineTo(0,c/2),a.graphics.endStroke(),a.graphics.endFill()};b3editor.draw.rootShape=function(c,d){var e=c._width,f=c._height,g=d.get("anchor_offset_x"),h=c._shapeObject;a(h,e/2+g,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(h,e,f,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3editor.draw.compositeShape=function(c,d){var e=c._symbolObject.getBounds(),f=0;e&&(f=e.width+20);var g=Math.max(f,c._width),h=c._height,i=d.get("anchor_offset_x"),j=c._shapeObject;c._width=g,c._height=h,a(j,-g/2-i,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),a(j,g/2+i,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(j,g,h,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3editor.draw.decoratorShape=function(b,c){var e=b._symbolObject.getBounds(),f=Math.max(e.width+40,b._width),g=Math.max(e.height+50,b._height),h=c.get("anchor_offset_x"),i=b._shapeObject;b._width=f,b._height=g,a(i,-f/2-h,0,c.get("anchor_radius"),c.get("anchor_background_color"),c.get("anchor_border_width"),c.get("anchor_border_color")),a(i,f/2+h,0,c.get("anchor_radius"),c.get("anchor_background_color"),c.get("anchor_border_width"),c.get("anchor_border_color")),d(i,f,g,15,c.get("block_background_color"),c.get("block_border_width"),c.get("block_border_color"))},b3editor.draw.actionShape=function(c,d){var e=c._symbolObject.getBounds(),f=Math.max(e.width+15,c._width),g=Math.max(e.height+15,c._height),h=d.get("anchor_offset_x"),i=c._shapeObject;c._width=f,c._height=g,a(i,-f/2-h,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),b(i,f,g,15,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))},b3editor.draw.conditionShape=function(b,d){var e=b._symbolObject.getBounds(),f=Math.max(e.width+15,b._width),g=Math.max(e.height+15,b._height),h=d.get("anchor_offset_x"),i=b._shapeObject;b._width=f,b._height=g,a(i,-f/2-h,0,d.get("anchor_radius"),d.get("anchor_background_color"),d.get("anchor_border_width"),d.get("anchor_border_color")),c(i,f,g,d.get("block_background_color"),d.get("block_border_width"),d.get("block_border_color"))}}(),this.b3editor=this.b3editor||{},this.b3editor.draw=this.b3editor.draw||{},function(){"use strict";b3editor.draw.rootSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/5,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.drawCircle(0,0,f),c.graphics.moveTo(-f,f),c.graphics.lineTo(f,-f),c.graphics.endStroke(),c},b3editor.draw.sequenceSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/4,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.moveTo(-f,0),c.graphics.lineTo(f,0),c.graphics.drawPolyStar(f/2,0,f/2,3,0,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.memsequenceSymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/4,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.drawPolyStar(0,.75*-f,f/2,6,f/10,0),c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.beginFill(g),c.graphics.moveTo(-f,f/2),c.graphics.lineTo(f,f/2),c.graphics.drawPolyStar(f/2,f/2,f/2,3,0,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.prioritySymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/8,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.arc(0,-f,f,3.141561,1.570796,!1),c.graphics.lineTo(0,f),c.graphics.beginFill(g),c.graphics.drawCircle(0,2*f,e/2),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.memprioritySymbol=function(a,b){var c=new createjs.Shape,d=(a._width,a._height),e=d/20,f=d/8,g=b.get("block_symbol_color");return c.graphics.setStrokeStyle(e,"round"),c.graphics.beginStroke(g),c.graphics.arc(-f,-f,f,3.141561,1.570796,!1),c.graphics.lineTo(-f,f),c.graphics.beginFill(g),c.graphics.drawCircle(-f,2*f,e/2),c.graphics.drawPolyStar(1.5*f,0,f/2,6,f/10,0),c.graphics.endFill(),c.graphics.endStroke(),c},b3editor.draw.textSymbol=function(a){var b=new createjs.Text(a.getTitle(),"18px Arial","#333333");b.textAlign="center";var c=b.getBounds();return b.regY=c.height/2,b}}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(a){var b=a.prototype;b||(b=a),this.id=b3.createUUID(),this.node=a,this.name=b.name,this.category=b.category,this.title=b.title||this.name,this.description=b.description||"",this.properties=$.extend({},b.parameters,b.properties),this.displayObject=new createjs.Container,this.inConnection=null,this.outConnections=[],this.isSelected=!1,this.isDragging=!1,this.dragOffsetX=0,this.dragOffsetX=0,this._width=null,this._height=null,this._shapeObject=new createjs.Shape,this._shadowObject=null,this._symbolObject=null,this.applySettings(app.settings)},b.applySettings=function(a){this.settings=a||this.settings,this._shadowObject=new createjs.Shadow(this.settings.get("selection_color"),0,0,5),this.redraw()},b.copy=function(){var a=new b3editor.Block(this.node);return a.displayObject.x=this.displayObject.x,a.displayObject.y=this.displayObject.y,a._width=this._width,a._height=this._height,a.anchorXOffset=this.anchorXOffset,a.category=this.category,a.title=this.title,a.description=this.description,a},b.redraw=function(){var a=this.settings,b=this.name,c=this.category.toLowerCase(),d=app.editor.shapes[c],e=app.editor.symbols[b]||b3editor.draw.textSymbol;this._width=a.get("block_"+c+"_width"),this._height=a.get("block_"+c+"_height"),this.displayObject.removeAllChildren(),this._symbolObject=e(this,a),this._shapeObject.graphics.clear(),d(this,a),this.displayObject.addChild(this._shapeObject),this.displayObject.addChild(this._symbolObject)},b.getTitle=function(){var a=this.title||this.name,b=this;return a.replace(/(<\w+>)/g,function(a,c){var d=c.substring(1,c.length-1);return b.properties.hasOwnProperty(d)?b.properties[d]:a})},b.select=function(){this.isSelected=!0,this._shapeObject.shadow=this._shadowObject},b.deselect=function(){this.isSelected=!1,this._shapeObject.shadow=null},b.getOutNodeIds=function(){for(var a=[],b=0;b<this.outConnections.length;b++)a.push(this.outConnections[b].outBlock.id);return a},b.getOutNodeIdsByOrder=function(){for(var a=[],b=this.getOutConnectionsByOrder(),c=0;c<b.length;c++)a.push(b[c].outBlock.id);return a},b.getOutConnectionsByOrder=function(){var a=this.outConnections.slice(0);return a.sort(function(a,b){return a.outBlock.displayObject.y-b.outBlock.displayObject.y}),a},b.addInConnection=function(a){this.inConnection=a},b.addOutConnection=function(a){this.outConnections.push(a)},b.removeInConnection=function(){this.inConnection=null},b.removeOutConnection=function(a){var b=this.outConnections.indexOf(a);b>-1&&this.outConnections.splice(b,1)},b.hitTest=function(a,b){return a-=this.displayObject.x,b-=this.displayObject.y,this._shapeObject.hitTest(a,b)},b.isContainedIn=function(a,b,c,d){return a<this.displayObject.x-this._width/2&&b<this.displayObject.y-this._height/2&&c>this.displayObject.x+this._width/2&&d>this.displayObject.y+this._height/2?!0:!1},b.getLeftAnchorX=function(){return this.displayObject.x-this._width/2-this.settings.get("anchor_offset_x")},b.getRightAnchorX=function(){return this.displayObject.x+this._width/2+this.settings.get("anchor_offset_x")},b.mouseInBlock=function(a){return Math.abs(a-this.displayObject.x)<this._width/2},b.mouseInLeftAnchor=function(a){var b=a-this.displayObject.x;return Math.abs(b)>this._width/2&&0>b},b.mouseInRightAnchor=function(a){var b=a-this.displayObject.x;return Math.abs(b)>this._width/2&&b>0},b3editor.Block=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.inBlock=null,this.outBlock=null,this.settings=null,this.displayObject=new createjs.Shape,this.applySettings(app.settings)},b.addInBlock=function(a){this.inBlock=a},b.addOutBlock=function(a){this.outBlock=a},b.removeInBlock=function(){this.inBlock=null},b.removeOutBlock=function(){this.outBlock=null},b.applySettings=function(a){this.settings=a,this.redraw()},b.redraw=function(a,b,c,d){if((this.inBlock||null!=a||null!=b)&&(this.outBlock||null!=c||null!=d)){var e=this.settings,f=this.displayObject.graphics,g=e.get("connection_width"),h=e.get("connection_color"),i=e.get("anchor_radius")+e.get("anchor_border_width"),j=e.get("anchor_radius")/2;a=0==a||a?a:this.inBlock.getRightAnchorX(),c=0==c||c?c:this.outBlock.getLeftAnchorX()-i,b=0==b||b?b:this.inBlock.displayObject.y,d=0==d||d?d:this.outBlock.displayObject.y;var k=2.5*(c-a)/4;f.clear(),f.setStrokeStyle(g,"round"),f.beginStroke(h),f.moveTo(a,b),f.bezierCurveTo(a+k,b,c-k,d,c,d),f.beginFill(h),f.drawPolyStar(c-j,d,j,3,0,0),f.endFill(),f.endStroke()}},b3editor.Connection=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.settings=null,this.displayObject=new createjs.Shape,this.displayObject.alpha=.3,this.displayObject.visible=!1,this.applySettings(app.settings)},b.applySettings=function(a){this.settings=a,this.redraw()},b.redraw=function(a,b,c,d){var e=this.settings.get("selection_color"),f=this.displayObject.graphics,g=Math.min(a,c),h=Math.min(b,d),i=Math.abs(a-c),j=Math.abs(b-d);f.clear(),f.beginFill(e),f.drawRect(g,h,i,j),f.endFill()},b3editor.SelectionBox=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.isDragging=!1,this.offsetX=0,this.offsetY=0;var a=this;app.game.stage.on("stagemousedown",this.onMouseDown,this),app.game.stage.on("stagemousemove",this.onMouseMove,this),app.game.stage.on("stagemouseup",this.onMouseUp,this),app.game.canvas.addEventListener("mousewheel",function(b){a.onMouseWheel(b)}),app.game.canvas.addEventListener("DOMMouseScroll ",function(b){a.onMouseWheel(b)},!1)},b.onMouseDown=function(a){2===a.nativeEvent.which&&($(app.game.canvas).addClass("grabbing"),this.isDragging=!0,this.offsetX=app.game.stage.mouseX-app.game.camera.x,this.offsetY=app.game.stage.mouseY-app.game.camera.y)},b.onMouseMove=function(){this.isDragging&&(app.game.camera.x=app.game.stage.mouseX-this.offsetX,app.game.camera.y=app.game.stage.mouseY-this.offsetY)},b.onMouseUp=function(a){2===a.nativeEvent.which&&($(app.game.canvas).removeClass("grabbing"),this.isDragging=!1,this.offsetX=0,this.offsetY=0)},b.onMouseWheel=function(a){a.wheelDeltaY>0?app.editor.zoomIn():app.editor.zoomOut()},b3editor.CameraSystem=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.entity=null,app.game.stage.on("stagemousedown",this.onMouseDown,this),app.game.stage.on("stagemousemove",this.onMouseMove,this),app.game.stage.on("stagemouseup",this.onMouseUp,this)},b.onMouseDown=function(a){if(1===a.nativeEvent.which){var b=app.game.getLocalMousePosition(),c=b.x,d=b.y,e=app.editor.getBlockUnder(c,d);if(!this.entity&&e)if(e.mouseInRightAnchor(c,d))this.entity=app.editor.addConnection(e);else if(e.mouseInLeftAnchor(c,d)){var f=e.inConnection;if(!f)return;e.removeInConnection(),f.removeOutBlock(),this.entity=f}}},b.onMouseMove=function(){if(this.entity){var a=app.game.getLocalMousePosition(),b=a.x,c=a.y;this.entity.redraw(null,null,b,c)}},b.onMouseUp=function(a){if(1===a.nativeEvent.which&&this.entity){var b=app.game.getLocalMousePosition(),c=b.x,d=b.y,e=app.editor.getBlockUnder(c,d);e&&e!==this.entity.inBlock&&"root"!==e.category?(e.inConnection&&app.editor.removeConnection(e.inConnection),("root"===this.entity.inBlock.category||"decorator"===this.entity.inBlock.category)&&this.entity.inBlock.outConnections.length>1&&app.editor.removeConnection(this.entity.inBlock.outConnections[0]),this.entity.addOutBlock(e),e.addInConnection(this.entity),this.entity.redraw()):app.editor.removeConnection(this.entity),this.entity=null}},b3editor.ConnectionSystem=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.isDragging=!1,app.game.stage.on("stagemousedown",this.onMouseDown,this),app.game.stage.on("stagemousemove",this.onMouseMove,this),app.game.stage.on("stagemouseup",this.onMouseUp,this)},b.onMouseDown=function(a){if(1===a.nativeEvent.which&&!key.ctrl&&!this.isDragging){var b=app.game.getLocalMousePosition(),c=b.x,d=b.y,e=app.editor.getBlockUnder(c,d);if(e&&e.isSelected&&e.mouseInBlock(c,d)){this.isDragging=!0;for(var f=0;f<app.editor.selectedBlocks.length;f++){var e=app.editor.selectedBlocks[f];e.isDragging=!0,e.dragOffsetX=c-e.displayObject.x,e.dragOffsetY=d-e.displayObject.y}}}},b.onMouseMove=function(){if(this.isDragging)for(var a=app.game.getLocalMousePosition(),b=a.x,c=a.y,d=0;d<app.editor.selectedBlocks.length;d++){var e=app.editor.selectedBlocks[d],f=b-e.dragOffsetX,g=c-e.dragOffsetY;e.displayObject.x=f-f%app.settings.get("snap_x"),e.displayObject.y=g-g%app.settings.get("snap_y"),e.inConnection&&e.inConnection.redraw();for(var h=0;h<e.outConnections.length;h++)e.outConnections[h].redraw()}},b.onMouseUp=function(a){if(1===a.nativeEvent.which&&this.isDragging){this.isDragging=!1;for(var b=0;b<app.editor.selectedBlocks.length;b++){var c=app.editor.selectedBlocks[b];c.isDragging=!1}}},b3editor.DragSystem=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.isSelecting=!1,this.ctrl=!1,this.x1=0,this.y1=0,app.game.stage.on("stagemousedown",this.onMouseDown,this),app.game.stage.on("stagemousemove",this.onMouseMove,this),app.game.stage.on("stagemouseup",this.onMouseUp,this)},b.onMouseDown=function(a){if(1===a.nativeEvent.which){var b=app.game.getLocalMousePosition(),c=b.x,d=b.y,e=app.editor.getBlockUnder(c,d);e?e.isSelected?key.ctrl&&app.editor.deselect(e):e.mouseInBlock(c,d)&&(key.ctrl||app.editor.deselectAll(),app.editor.select(e)):(this.isSelecting=!0,this.x1=c,this.y1=d,key.ctrl?this.ctrl=!0:app.editor.deselectAll())}},b.onMouseMove=function(){if(this.isSelecting){var a=app.game.getLocalMousePosition(),b=a.x,c=a.y;app.editor.selectionBox.displayObject.visible=!0,app.editor.selectionBox.redraw(this.x1,this.y1,b,c)}},b.onMouseUp=function(a){if(1===a.nativeEvent.which&&this.isSelecting){for(var b=app.game.getLocalMousePosition(),c=b.x,d=b.y,e=Math.min(this.x1,c),f=Math.min(this.y1,d),g=Math.max(this.x1,c),h=Math.max(this.y1,d),i=0;i<app.editor.blocks.length;i++){var j=app.editor.blocks[i];j.isContainedIn(e,f,g,h)&&app.editor.invertSelection(j)}app.editor.selectionBox.displayObject.visible=!1,this.isSelecting=!1,this.ctrl=!1}},b3editor.SelectionSystem=a}(),this.app=this.app||{},this.app.helpers=this.app.helpers||{},function(){"use strict";var a=function(a){var b=$('<li class="header"><a href="#">'+a+"</a></li>");return b},b=function(a,b){var c=$('<li class="item"></li>'),d=$('<a href="#">'+a+"</a>");return d.attr("data-name",b),d.attr("id","node-"+b),c.append(d),c},c=function(c){var d=a(c),e=$("<ul></ul>");for(var f in app.editor.nodes){var g=app.editor.nodes[f];if(g.prototype.category==c){var h=g.prototype.title||g.prototype.name,h=h.replace(/(<\w+>)/g,function(){return"@"}),i=b(h,g.prototype.name);e.append(i)}}return d.append(e),d},d=function(){var a=$('<ul id="node-list"><ul>');return a.append(c("composite")),a.append(c("decorator")),a.append(c("condition")),a.append(c("action")),a};app.helpers.updateNodes=function(){var a=d();app.dom.nodesPanel.html(a),app.dom.nodesComp=$("#node-list"),app.helpers._updateCollapsable(),app.helpers._updateDraggable(),app.helpers._updateDroppable(),$("li.item a",app.dom.nodesComp).each(function(){var a=$(this),b=a.attr("data-name");if(!b3[b]){var c=$('<a href="#" class="edit right">Edit</a>');c.hide(),c.click(function(a){app.events.onOpenEditNodeModal(a)}),c.attr("data-reveal-id","modalEditNode"),a.addClass("node"),a.append(c),a.hover(function(){c.toggle()})}})},app.helpers.updateProperties=function(a){if(app.block&&app.helpers.updateBlock(),app.block=a,a){app.dom.propertiesPanel.show(),app.dom.propertiesAlternatePanel.hide(),$("#title",app.dom.propertiesPanel).val(a.title),$("#description",app.dom.propertiesPanel).val(a.description);var b=$("#properties-table",app.dom.propertiesPanel);app.helpers.remAllEditableRows(b);for(var c in a.properties)app.helpers.addEditableRow(b,c,a.properties[c])}else app.dom.propertiesPanel.hide(),app.dom.propertiesAlternatePanel.show()},app.helpers.updateHelp=function(){},app.helpers.updateBlock=function(){if(app.block){var a=$("#title",app.dom.propertiesPanel).val(),b=$("#description",app.dom.propertiesPanel).val(),c={};$("#properties-table > .editable-row",app.dom.propertiesPanel).each(function(){var a=$(this),b=$(".key > input",a).val(),d=$(".value > input",a).val();$.isNumeric(d)&&(d=parseFloat(d)),b&&(c[b]=d)}),app.block.title=a,app.block.description=b,app.block.properties=c,app.block.redraw()}},app.helpers.addEditableRow=function(a,b,c){b=b||"",null==c&&(c=c||"");var d=$('<div class="editable-row"></div>'),e=$('<div class="editable-col key"><input type="text" placeholder="Key" value="'+b+'"></div>'),f=$('<div class="editable-col value"><input type="text" placeholder="Value" value="'+c+'"></div>'),g=$('<div class="editable-col operator"><input type="button" class="operator" value="-"></div>');g.click(app.events.onRemEditableRow),d.append(e),d.append(f),d.append(g),d.hide(),d.fadeIn(100),$("input",d).change(app.events.onPropertyChange),a.append(d)},app.helpers.remEditableRow=function(a){a.remove(),app.helpers.updateBlock()},app.helpers.remAllEditableRows=function(a){a.html("")},app.helpers.addDynamicRow=function(a){var b=$("<tr></tr>"),c=$('<td><input id="name" type="text" placeholder="Node name" value=""></td>'),d=$('<td><input id="title" type="text" placeholder="Node title" value=""></td>'),e=$('<td><select id="category"><option value="composite">Composite</option><option value="decorator">Decorator</option><option value="condition">Condition</option><option value="action" selected>Action</option></select></td>'),f=$('<td class="operator"><input type="button" class="operator" value="-"></td>');f.click(app.events.onRemDynamicRow),b.append(c),b.append(d),b.append(e),b.append(f),b.hide(),b.fadeIn(100),a.append(b)},app.helpers.remDynamicRow=function(a){a.remove()},app.helpers.resetDynamicTable=function(a){a.html(""),app.helpers.addDynamicRow(a),app.helpers.addDynamicRow(a),app.helpers.addDynamicRow(a)},app.helpers.addCustomNodes=function(a){var b={composite:b3.Composite,decorator:b3.Decorator,condition:b3.Condition,action:b3.Action};$("tr",a).each(function(){var a=$("#name",this).val(),c=$("#title",this).val(),d=$("#category",this).val(),e=b[d];if(a){if(app.editor.nodes[a])return void app.helpers.alert("error",'Node name "'+a+'" already registered.');var f=b3.Class(e);f.prototype.name=a,f.prototype.title=c,app.editor.registerNode(f)}}),app.helpers.updateNodes()},app.helpers.addCustomNode=function(a){var b={composite:b3.Composite,decorator:b3.Decorator,condition:b3.Condition,action:b3.Action},c=a.category,d=b[c],e=b3.Class(d);e.prototype.name=a.name,e.prototype.title=a.title,app.editor.registerNode(e),app.helpers.updateNodes()},app.helpers.alert=function(a,b){$.notify(b,a)},app.helpers.updateShortcuts=function(){for(var a in app.settings._dict)if(0==a.indexOf("key_")){var b=app.settings.get(a);$("#"+a).html(b);var c=app.KEY_MAP[a];c&&key(b,c)}},app.helpers._updateCollapsable=function(){app.dom.nodesComp.collapsable()},app.helpers._updateDraggable=function(){$("li.item > a",app.dom.nodesComp).draggable({cursorAt:{top:100,left:200},appendTo:"body",helper:app.events.onNodeDrag})},app.helpers._updateDroppable=function(){app.dom.gameCanvas.droppable({greedy:!0,drop:app.events.onNodeDrop})}}(),this.app=this.app||{},this.app.events=this.app.events||{},function(){"use strict";app.events.onBlockSelect=function(a){var b=null;0==app.editor.selectedBlocks.length&&(b=a._target),app.helpers.updateProperties(b)},app.events.onBlockDeselect=function(a){var b=null;2==app.editor.selectedBlocks.length&&(b=app.editor.selectedBlocks[0]!==a._target?app.editor.selectedBlocks[0]:app.editor.selectedBlocks[1]),app.helpers.updateProperties(b)},app.events.onNodeDrag=function(){var a=$('<canvas id="preview-canvas" width="400", height="200"></canvas>'),b=$(this).attr("data-name"),c=app.editor.nodes[b],d=new b3editor.Block(c),e=d.displayObject;e.x=200,e.y=100;var f=new createjs.Stage(a.get(0));return f.addChild(e),f.update(),a.addClass("grabbing"),a},app.events.onNodeDrop=function(a,b){var c=$(b.draggable).attr("data-name"),d=app.editor.nodes[c],e=app.game.getLocalMousePosition(),f=app.editor.addBlock(d,e.x,e.y);app.editor.snap(f),app.editor.deselectAll(),app.editor.select(f)},app.events.onOpenEditNodeModal=function(a){var b=$(a.target).parent(),c=b.attr("data-name"),d=app.editor.nodes[c];app.dom.editNodeTable.attr("data-name",d.prototype.name),$("#name",app.dom.editNodeTable).val(d.prototype.name),$("#title",app.dom.editNodeTable).val(d.prototype.title)},app.events.onNodeEditSave=function(){app.helpers.updateBlock(),app.editor.deselectAll();var a=app.dom.editNodeTable.attr("data-name"),b=app.editor.nodes[a],c=b.prototype.title,d=$("#name",app.dom.editNodeTable).val(),e=$("#title",app.dom.editNodeTable).val();if(a!==d&&app.editor.nodes[d])return void app.helpers.alert("error",'Node name "'+d+'" already registered.');b.prototype.name=d,b.prototype.title=e;for(var f=0;f<app.editor.blocks.length;f++){var g=app.editor.blocks[f];g.node===b&&(g.name=d,(g.title===c||g.title===a)&&(g.title=e||d),g.redraw())}delete app.editor.nodes[a],app.editor.nodes[d]=b,app.helpers.updateNodes()},app.events.onNodeEditRemove=function(){app.helpers.updateBlock(),app.editor.deselectAll();for(var a=app.dom.editNodeTable.attr("data-name"),b=app.editor.nodes[a],c=app.editor.blocks.length-1;c>=0;c--){var d=app.editor.blocks[c];d.node===b&&app.editor.removeBlock(d)}delete app.editor.nodes[a],app.helpers.updateNodes()},app.events.onAddEditableRow=function(a){app.helpers.addEditableRow(a)},app.events.onRemEditableRow=function(a){$(a.target).attr("data-id");app.helpers.remEditableRow($(this).parent())},app.events.onPropertyChange=function(){app.helpers.updateBlock()},app.events.onAddDynamicRow=function(a){app.helpers.addDynamicRow(a)},app.events.onRemDynamicRow=function(a){$(a.target).attr("data-id");app.helpers.remDynamicRow($(this).parent())},app.events.onButtonNewTree=function(){return app.editor.reset(),app.editor.center(),!1},app.events.onButtonImportTree=function(){var a=app.dom.importEntry.val();try{app.editor.importFromJSON(a),app.helpers.updateNodes()}catch(b){app.helpers.alert("error","Bad input format, check the console to know more about this error."),console.error(b),app.editor.center()}return!1},app.events.onButtonExportTree=function(){app.helpers.updateBlock(),app.dom.exportEntry.val("");var a=app.editor.exportToJSON();return app.dom.exportEntry.val(a),!1},app.events.onButtonCopy=function(){return app.editor.copy(),!1},app.events.onButtonCut=function(){return app.editor.cut(),!1},app.events.onButtonPaste=function(){return app.editor.paste(),!1},app.events.onButtonRemove=function(){return app.editor.remove(),!1},app.events.onButtonRemoveConnections=function(){return app.editor.removeConnections(),!1},app.events.onButtonRemoveInConnections=function(){return app.editor.removeInConnections(),!1},app.events.onButtonRemoveOutConnections=function(){return app.editor.removeOutConnections(),!1},app.events.onButtonAutoOrganize=function(){return app.editor.organize(),!1},app.events.onButtonZoomIn=function(){return app.editor.zoomIn(),!1},app.events.onButtonZoomOut=function(){return app.editor.zoomOut(),!1},app.events.onButtonSelectAll=function(){return app.editor.selectAll(),!1},app.events.onButtonDeselectAll=function(){return app.editor.deselectAll(),!1},app.events.onButtonInvertSelection=function(){return app.editor.invertSelection(),!1}}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(),b=a.prototype;b.initialize=function(){this.canvas=app.dom.gameCanvas[0],this.stage=new createjs.Stage(this.canvas),this.display=new creatine.Display(this.canvas),this.display.setUserSelect(!1),this.display.setTouchAction(!1),this.display.scaleMode=creatine.STRETCH,this.display.refresh(),this.stage.snapToPixelEnabled=!0,createjs.Ticker.setFPS(60),this.camera=new createjs.Container,this.layerConnections=new createjs.Container,this.layerBlocks=new createjs.Container,this.layerOverlay=new createjs.Container,this.applySettings(app.settings),this.camera.addChild(this.layerConnections),this.camera.addChild(this.layerBlocks),this.camera.addChild(this.layerOverlay),this.stage.addChild(this.camera);var a=this;createjs.Ticker.addEventListener("tick",function(){a.stage.update()})},b.getLocalMousePosition=function(){return this.camera.globalToLocal(this.stage.mouseX,this.stage.mouseY)},b.applySettings=function(a){this.canvas.style.background=a.get("background_color")},b3editor.Game=a}(),this.b3editor=this.b3editor||{},function(){"use strict";var a=b3.Class(createjs.EventDispatcher),b=a.prototype;b._initialize=function(){this.blocks=[],this.connections=[],this.nodes={},this.symbols={},this.shapes={},this.systems=[],this.clipboard=[],this.selectedBlocks=[],this.selectionBox=new b3editor.SelectionBox,this.insertingBlockId=null,this.defaultNodes=[b3editor.Root,b3.Sequence,b3.Priority,b3.MemSequence,b3.MemPriority,b3.Repeater,b3.RepeatUntilFailure,b3.RepeatUntilSuccess,b3.MaxTime,b3.Inverter,b3.Limiter,b3.Failer,b3.Succeeder,b3.Runner,b3.Error,b3.Wait],this.organizer=new b3editor.Organizer,this.registerSystem(new b3editor.CameraSystem),this.registerSystem(new b3editor.SelectionSystem),this.registerSystem(new b3editor.DragSystem),this.registerSystem(new b3editor.ConnectionSystem),this.registerShape("root",b3editor.draw.rootShape),this.registerShape("composite",b3editor.draw.compositeShape),this.registerShape("decorator",b3editor.draw.decoratorShape),this.registerShape("condition",b3editor.draw.conditionShape),this.registerShape("action",b3editor.draw.actionShape),this.registerSymbol("Root",b3editor.draw.rootSymbol),this.registerSymbol("Sequence",b3editor.draw.sequenceSymbol),this.registerSymbol("MemSequence",b3editor.draw.memsequenceSymbol),this.registerSymbol("Priority",b3editor.draw.prioritySymbol),this.registerSymbol("MemPriority",b3editor.draw.memprioritySymbol);for(var a=0;a<this.defaultNodes.length;a++)this.registerNode(this.defaultNodes[a]);app.game.layerOverlay.addChild(this.selectionBox.displayObject),this.reset(),this.center()},b.registerNode=function(a){var b=a.prototype.name;this.nodes[b]=a},b.registerSymbol=function(a,b){b||(b=a),this.symbols[a]=b},b.registerShape=function(a,b){this.shapes[a]=b},b.registerSystem=function(a,b){b?this.systems.splice(0,0,a):this.systems.push(a)},b.getRoot=function(){for(var a=0;a<this.blocks.length;a++)if("root"===this.blocks[a].category)return this.blocks[a]},b.getBlockUnder=function(a,b){if(!a||!b){var c=app.game.getLocalMousePosition();a=c.x,b=c.y}for(var d=this.blocks.length-1;d>=0;d--){var e=this.blocks[d];if(e.hitTest(a,b))return e}},b.getBlockById=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];if(c.id==a)return c}},b.applySettings=function(a){var a=a||app.settings;app.game.applySettings(a);for(var b=0;b<this.blocks.length;b++)this.blocks[b].applySettings(a);for(var b=0;b<this.connections.length;b++)this.connections[b].applySettings(a)},b.importFromJSON=function(a){this.reset();var b=JSON.parse(a),c=null,d=b.display?!0:!1;if(b.custom_nodes)for(var e=0;e<b.custom_nodes.length;e++){var f=b.custom_nodes[e];this.nodes[f.name]||this.createNodeType(f)}for(var g in b.nodes){var h=b.nodes[g];h.display=h.display||{};var i=this.addBlock(h.name,h.display.x,h.display.y);i.id=h.id,i.title=h.title,i.description=h.description,i.properties=$.extend({},h.parameters,h.properties),
i.redraw(),i.id===b.root&&(c=i)}for(var g in b.nodes){var h=b.nodes[g],j=this.getBlockById(g),k=null;if("composite"==j.category&&h.children?k=h.children:("decorator"==j.category&&h.child||"root"==j.category&&h.child)&&(k=[h.child]),k)for(var e=0;e<k.length;e++){var l=this.getBlockById(k[e]);this.addConnection(j,l)}}c&&this.addConnection(this.getRoot(),c),b.display=b.display||{},app.game.camera.x=b.display.camera_x||0,app.game.camera.y=b.display.camera_y||0,app.game.camera.scaleX=b.display.camera_z||1,app.game.camera.scaleY=b.display.camera_z||1,d||this.organize(!0)},b.exportToJSON=function(){var a=this.getRoot(),b={};b.title=a.title,b.description=a.description,b.root=a.getOutNodeIds()[0]||null,b.display={camera_x:app.game.camera.x,camera_y:app.game.camera.y,camera_z:app.game.camera.scaleX,x:a.displayObject.x,y:a.displayObject.y},b.properties=a.properties,b.nodes={},b.custom_nodes=[];for(var c in this.nodes){var d=this.nodes[c];if(-1===this.defaultNodes.indexOf(d)){var e={name:d.prototype.name,title:d.prototype.title,category:d.prototype.category};b.custom_nodes.push(e)}}for(var f=0;f<this.blocks.length;f++){var g=this.blocks[f];if("root"!==g.category){var h={};h.id=g.id,h.name=g.name,h.title=g.title,h.description=g.description,h.display={x:g.displayObject.x,y:g.displayObject.y},h.parameters=g.parameters,h.properties=g.properties;var i=g.getOutNodeIdsByOrder();"composite"==g.category?h.children=i:("decorator"==g.category||"root"==g.category)&&(h.child=i[0]||null),b.nodes[g.id]=h}}return JSON.stringify(b,null,4)},b.createNodeType=function(a){var b={composite:b3.Composite,decorator:b3.Decorator,condition:b3.Condition,action:b3.Action},c=a.category,d=b[c],e=b3.Class(d);e.prototype.name=a.name,e.prototype.title=a.title,this.registerNode(e)},b.zoom=function(a){app.game.camera.scaleX=a,app.game.camera.scaleY=a},b.pan=function(a,b){app.game.camera.x+=a,app.game.camera.y+=b},b.setcam=function(a,b){app.game.camera.x=a,app.game.camera.y=b},b.center=function(){var a=app.game.canvas.width/2,b=app.game.canvas.height/2;this.setcam(a,b)},b.organize=function(a){this.organizer.organize(this.getRoot(),a)},b.reset=function(a){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];app.game.layerBlocks.removeChild(c.displayObject)}this.blocks=[];for(var b=0;b<this.connections.length;b++){var d=this.connections[b];app.game.layerConnections.removeChild(d.displayObject)}this.connections=[],app.game.camera.x=0,app.game.camera.y=0,app.game.camera.scaleX=1,app.game.camera.scaleY=1,a||this.addBlock("Root",0,0)},b.snap=function(a){a?$.isArray(a)||(a=[a]):a=this.blocks;for(var b=app.settings.get("snap_x"),c=app.settings.get("snap_y"),d=0;d<a.length;d++){var e=a[d];e.displayObject.x-=e.displayObject.x%b,e.displayObject.y-=e.displayObject.y%c}},b.addBlock=function(a,b,c){if(b=b||0,c=c||0,"string"==typeof a)var d=this.nodes[a];else var d=a;var e=new b3editor.Block(d);return e.displayObject.x=b,e.displayObject.y=c,this.blocks.push(e),app.game.layerBlocks.addChild(e.displayObject),e},b.addConnection=function(a,b){var c=new b3editor.Connection(this);return a&&(c.addInBlock(a),a.addOutConnection(c)),b&&(c.addOutBlock(b),b.addInConnection(c)),this.connections.push(c),app.game.layerConnections.addChild(c.displayObject),c.redraw(),c},b.removeBlock=function(a){var b=this.blocks.indexOf(a);if(b>-1&&this.blocks.splice(b,1),a.inConnection&&this.removeConnection(a.inConnection),a.outConnections.length>0)for(var c=a.outConnections.length-1;c>=0;c--)this.removeConnection(a.outConnections[c]);app.game.layerBlocks.removeChild(a.displayObject)},b.removeConnection=function(a){a.inBlock&&(a.inBlock.removeOutConnection(a),a.removeInBlock()),a.outBlock&&(a.outBlock.removeInConnection(),a.removeOutBlock());var b=this.connections.indexOf(a);b>-1&&this.connections.splice(b,1),app.game.layerConnections.removeChild(a.displayObject)},b.select=function(a){if(!a.isSelected){var b=new createjs.Event("blockselect");b._target=a,this.dispatchEvent(b),a.select(),this.selectedBlocks.push(a)}},b.deselect=function(a){if(a.isSelected){var b=new createjs.Event("blockdeselect");b._target=a,this.dispatchEvent(b),a.deselect();var c=this.selectedBlocks.indexOf(a);c>-1&&this.selectedBlocks.splice(c,1)}},b.selectAll=function(){for(var a=0;a<this.blocks.length;a++)this.select(this.blocks[a])},b.deselectAll=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=new createjs.Event("blockdeselect");b._target=this.selectedBlocks[a],this.dispatchEvent(b),this.selectedBlocks[a].deselect()}this.selectedBlocks=[]},b.invertSelection=function(a){for(var b=a?[a]:this.blocks,c=0;c<b.length;c++){var a=b[c];a.isSelected?this.deselect(a):this.select(a)}},b.copy=function(){this.clipboard=[];for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];"root"!=b.category&&this.clipboard.push(b)}},b.cut=function(){this.clipboard=[];for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];"root"!=b.category&&(this.removeBlock(b),this.clipboard.push(b))}this.selectedBlocks=[]},b.paste=function(){for(var a=[],b=0;b<this.clipboard.length;b++){var c=this.clipboard[b],d=c.copy();d.displayObject.x+=50,d.displayObject.y+=50,this.blocks.push(d),app.game.layerBlocks.addChild(d.displayObject),a.push(d)}for(var b=0;b<this.clipboard.length;b++)for(var e=this.clipboard[b],d=a[b],f=0;f<e.outConnections.length;f++)for(var g=0;g<this.clipboard.length;g++)if(e.outConnections[f].outBlock===this.clipboard[g]){this.addConnection(d,a[g]);break}this.deselectAll();for(var b=0;b<a.length;b++)this.select(a[b]);this.snap(a)},b.remove=function(){for(var a=null,b=0;b<this.selectedBlocks.length;b++)"root"==this.selectedBlocks[b].category?a=this.selectedBlocks[b]:this.removeBlock(this.selectedBlocks[b]);this.deselectAll(),a&&this.select(a)},b.removeConnections=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];if(b.inConnection&&this.removeConnection(b.inConnection),b.outConnections.length>0)for(var c=b.outConnections.length-1;c>=0;c--)this.removeConnection(b.outConnections[c])}},b.removeInConnections=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];b.inConnection&&this.removeConnection(b.inConnection)}},b.removeOutConnections=function(){for(var a=0;a<this.selectedBlocks.length;a++){var b=this.selectedBlocks[a];if(b.outConnections.length>0)for(var c=b.outConnections.length-1;c>=0;c--)this.removeConnection(b.outConnections[c])}},b.zoomIn=function(){var a=app.settings.get("zoom_min"),b=app.settings.get("zoom_max"),c=app.settings.get("zoom_step"),d=app.game.camera.scaleX;this.zoom(creatine.clip(d+c,a,b))},b.zoomOut=function(){var a=app.settings.get("zoom_min"),b=app.settings.get("zoom_max"),c=app.settings.get("zoom_step"),d=app.game.camera.scaleX;this.zoom(creatine.clip(d-c,a,b))},b3editor.Editor=a}(),this.app=this.app||{},this.app.dom=this.app.dom||{},function(){"use strict";app.initialize=function(){app.initializeConstants(),app.initializeHTML(),app.initializeEditor(),app.initializePlugins()},app.initializeConstants=function(){app.KEY_MAP={key_select_all:app.events.onButtonSelectAll,key_deselect_all:app.events.onButtonDeselectAll,key_invert_selection:app.events.onButtonInvertSelection,key_copy:app.events.onButtonCopy,key_cut:app.events.onButtonCut,key_paste:app.events.onButtonPaste,key_remove:app.events.onButtonRemove,key_organize:app.events.onButtonAutoOrganize,key_zoom_in:app.events.onButtonZoomIn,key_zoom_out:app.events.onButtonZoomOut,key_new_tree:app.events.onButtonNewTree,key_import_tree:app.events.onButtonImportTree,key_export_tree:app.events.onButtonExportTree}},app.initializeHTML=function(){var a=$("#page");for(var b in loader._loadedResults)0===b.indexOf("view")&&a.append(loader.getResult(b));app.dom.page=$("#page"),app.dom.gameCanvas=$("#game-canvas"),app.dom.nodesPanel=$("#nodes-panel"),app.dom.propertiesPanel=$("#properties-panel"),app.dom.propertiesAlternatePanel=$("#properties-panel-alternate"),app.dom.helpPanel=$("#help-panel"),app.dom.exportEntry=$("#export-entry"),app.dom.importEntry=$("#import-entry"),app.dom.addNodeTable=$("#addnode-table"),app.dom.editNodeTable=$("#editnode-table")},app.initializeEditor=function(){app.storage=new creatine.Storage("b3editor"),"undefined"==typeof app.storage.get("firsttime")&&app.storage.set("firsttime",!0),app.settings=new b3editor.SettingsManager,app.settings.load(b3editor.OPTIONS),app.settings.load(b3editor.THEME_DARK),app.settings.load(b3editor.SHORTCUTS),app.game=new b3editor.Game,app.editor=new b3editor.Editor,app.editor._initialize(),app.editor.on("blockselect",app.events.onBlockSelect),app.editor.on("blockdeselect",app.events.onBlockDeselect),app.helpers.addCustomNode({category:"action",name:"c2Node",title:"Construct 2 Task"}),app.helpers.updateNodes(),app.helpers.updateShortcuts(),app.storage.get("firsttime")===!0&&(app.storage.set("firsttime",!1),$("#modalFirstTime").foundation("reveal","open"))},app.initializePlugins=function(){$(".nano").nanoScroller(),$(document).foundation(),$.notify.defaults({clickToHide:!0,autoHide:!0,autoHideDelay:5e3,arrowShow:!0,arrowSize:5,elementPosition:"bottom left",globalPosition:"bottom center",style:"bootstrap",className:"error",showAnimation:"slideDown",showDuration:400,hideAnimation:"slideUp",hideDuration:200,gap:2})}}();